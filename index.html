<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ilia Makeev | Data Scientist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="hero">
        <div class="hero-content">
            <h1 class="gradient-text">Ilia Makeev</h1>
            <div class="contact-info">
                <p><i class="fas fa-map-marker-alt"></i> Irvine, CA</p>
                <p><i class="fas fa-phone"></i> +1 (949) 279-2211</p>
                <p><i class="fas fa-envelope"></i> <a href="mailto:il.makeev@gmail.com">il.makeev@gmail.com</a></p>
                <p><i class="fab fa-github"></i> <a href="https://github.com/MakeevIlia" target="_blank">GitHub</a></p>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="card summary">
            <h2><i class="fas fa-user-tie"></i> Professional Summary</h2>
            <p>Data Scientist with 5+ years of experience and dual Master’s degrees in Computer Science and Big Data Analysis. Skilled in machine learning, NLP, and high-performance computing, with expertise in Python, PyTorch, and model deployment.</p>
        </section>

        <section class="card skills">
            <h2><i class="fas fa-tools"></i> Technical Skills</h2>
            <div class="skills-grid">
                <div class="skill-category">
                    <h3>Machine Learning & Deep Learning</h3>
                    <div class="skill-tags">
                        <span>Python (scikit-learn, NumPy, Pandas)</span>
                        <span>PyTorch</span>
                    </div>
                </div>
                <div class="skill-category">
                    <h3>Cloud & Deployment</h3>
                    <div class="skill-tags">
                        <span>Flask</span>
                        <span>Docker</span>
                        <span>AWS</span>
                        <span>GCP</span>
                        <span>Git</span>
                    </div>
                </div>
                <div class="skill-category">
                    <h3>NLP & Statistical Analysis</h3>
                    <div class="skill-tags">
                        <span>spaCy</span>
                        <span>NLTK</span>
                        <span>Statistical Analysis</span>
                        <span>Hypothesis Testing</span>
                        <span>R</span>
                    </div>
                </div>
                <div class="skill-category">
                    <h3>Big Data & Visualization</h3>
                    <div class="skill-tags">
                        <span>Spark</span>
                        <span>Hadoop</span>
                        <span>SQL</span>
                        <span>Tableau</span>
                        <span>Matplotlib</span>
                        <span>Seaborn</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="card experience">
            <h2><i class="fas fa-briefcase"></i> Experience</h2>
            <div class="timeline">
                <div class="timeline-item">
                    <h3>Research Assistant & Adjunct Professor</h3>
                    <p class="company">New Mexico Highlands University (Jan 2024 – Dec 2024)</p>
                    <ul>
                        <li>Conducted computational experiments using Python and C++ to model materials properties.</li>
                        <li>Optimized high-performance computing implementations, reducing simulation runtime by 80%.</li>
                        <li>Developed predictive models, improving lab efficiency by 53%.</li>
                        <li>Taught C++, Operating Systems, and Advanced Programming.</li>
                    </ul>
                </div>
                <div class="timeline-item">
                    <h3>Data Scientist</h3>
                    <p class="company">Yandex (Apr 2021 – Jan 2024)</p>
                    <ul>
                        <li>Built and deployed NLP models, improving lesson completion rates by 65%.</li>
                        <li>Engineered a recommendation system increasing lesson effectiveness by 60%.</li>
                        <li>Developed a Large Language Model, improving comprehension by 90%.</li>
                    </ul>
                </div>
                <div class="timeline-item">
                    <h3>Data Analyst</h3>
                    <p class="company">Yandex (Jun 2020 – Apr 2021)</p>
                    <ul>
                        <li>Cleaned and preprocessed large datasets, reducing inconsistencies by 68%.</li>
                        <li>Analyzed behavioral data, increasing student performance by 300%.</li>
                        <li>Designed and executed A/B tests to refine educational content.</li>
                    </ul>
                </div>
                <div class="timeline-item">
                    <h3>Author of Data Science Courses</h3>
                    <p class="company">Yandex (Mar 2019 – Jun 2020)</p>
                    <ul>
                        <li>Created and supervised 70+ lessons on statistics and data analysis.</li>
                        <li>Developed 500+ programming tasks and 100+ visual materials.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="card education">
            <h2><i class="fas fa-graduation-cap"></i> Education</h2>
            <ul>
                <li>M.S. in Computer Science, New Mexico Highlands University (GPA: 4.00/4.0)</li>
                <li>M.S. in Intelligent Analysis of Big Data, Lomonosov Moscow State University (GPA: 3.89/4.0)</li>
                <li>B.S. in Applied Mathematics, Bauman Moscow State Technical University (GPA: 3.78/4.0)</li>
            </ul>
        </section>

        <section class="card research">
            <h2><i class="fas fa-flask"></i> Research</h2>
            <ul>
                <h3>Original Time Series Forecasting Method</h3>
                    <ul>
                        <li>Developed a feature extraction method integrated with LSTM neural networks that increased forecasting accuracy by 20%, utilizing sliding window techniques and multivariate modeling to tackle complex data in climate science, stock price prediction, and medical data classification</li>
                    </ul>
                <h3>Regularized Estimation-Maximazition Algorithm</h3>
                    <ul>
                        <li>Researched the mathematical properties of the Expectation-Maximization (EM) algorithm, analyzing its convergence properties and introducing a Regularized EM approach based on maximizing Shannon’s Entropy. Demonstrated a 35% computing improvement over the original method</li>
                    </ul>
                <h3>Analysis of Erdos-Renyi Random Graphs</h3>
                    <ul>
                        <li>Analyzed random graph indicators’ convergence to the standard normal distribution, developed algorithms for convergence rates and error bounds, and achieved a 450% boost in computational efficiency</li>
                    </ul>
                
            </ul>
        </section>

        <section class="card certifications">
            <h2><i class="fas fa-certificate"></i> Certifications</h2>
            <ul>
                <li>Neural Networks & Computer Vision (Samsung AI Centre): Fine-tuned a CNN model (ResNet-18) to classify images using PyTorch on GPU.</li>
                <li>Neural Networks & Text Processing (Samsung AI Centre): Developed a text-based semantics analysis model using SVM with Scikit-Learn.</li>
            </ul>
        </section>
    </main>
</body>
</html>
 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Meeting Bingo</title>
  <style>
    :root{--bg:#0b0f14;--card:#121822;--muted:#93a1b1;--text:#e6edf3;--accent:#5ac8fa;--green:#34c759;--red:#ff3b30;--yellow:#ffd60a}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0f14,#0f1520);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px 16px 80px}
    .appbar{position:sticky;top:0;z-index:10;background:rgba(11,15,20,.85);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid #1f2632}
    .appbar-inner{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 16px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:28px;height:28px;border-radius:8px;background:radial-gradient(circle at 30% 30%,var(--accent),#7df);box-shadow:0 0 16px #5ac8fa55 inset,0 0 24px #5ac8fa33}
    h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.2px}
    .tabs{display:flex;gap:6px}
    .tab{border:1px solid #1f2632;background:#0f1520;color:#cbd5e1;padding:8px 12px;border-radius:10px;cursor:pointer}
    .tab.active{background:#162233;color:var(--text);border-color:#223047}

    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .card{background:linear-gradient(180deg,#121822,#0d131c);border:1px solid #1f2632;border-radius:14px;box-shadow:0 6px 24px #00000040;padding:14px}
    .panel{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .panel .card h3{margin:0 0 8px;font-size:14px;color:#cbd5e1}
    textarea,input,select,button{width:100%;border-radius:10px;border:1px solid #233044;background:#0c131c;color:var(--text);padding:10px;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center}
    .row>span{white-space:nowrap;color:#cbd5e1;font-size:13px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    button{cursor:pointer}
    button.primary{background:linear-gradient(180deg,#1d4ed8,#0f3ba1);border-color:#2552b9}
    button.ghost{background:#0c131c;border-color:#243042}
    .hint{font-size:12px;color:#93a1b1}

    /* Bingo board */
    .board{margin-top:14px}
    .cell{aspect-ratio:1/1;border-radius:12px;border:1px solid #253042;padding:10px;background:linear-gradient(180deg,#0f1622,#0b111b);display:flex;align-items:center;justify-content:center;text-align:center;font-size:13px;line-height:1.2;position:relative}
    .cell small{position:absolute;top:8px;left:10px;color:#8aa2b2;font-size:11px}
    .cell .label{padding-top:6px}
    .cell.free{background:linear-gradient(180deg,#082c1b,#071c12);border-color:#1f613f}
    .cell.marked{background:linear-gradient(180deg,#0b2a42,#081c2d);border-color:#2b8bd6;box-shadow:inset 0 0 0 2px #2b8bd6aa}
    .cell.marked:after{content:"✔";position:absolute;right:8px;bottom:6px;font-weight:700;color:var(--accent);font-size:16px}

    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #273244;background:#0b111b;color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:12px}
    .pill .dot{width:8px;height:8px;border-radius:50%}
    .dot.often{background:var(--green)}
    .dot.medium{background:var(--yellow)}
    .dot.rare{background:var(--red)}

    .footer{margin-top:16px;color:#8aa2b2;font-size:12px}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#0d1826;border:1px solid #22324a;padding:10px 14px;border-radius:10px;color:#dbeafe;box-shadow:0 10px 30px #0006;z-index:20;display:none}
    .toast.show{display:block}
    .bingo-banner{background:linear-gradient(90deg,#0ea5e9,#22c55e,#eab308,#ef4444);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800;letter-spacing:.5px}

    @media (max-width: 820px){
      .panel{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="appbar">
    <div class="appbar-inner">
      <div class="brand"><div class="logo"></div><h1>Meeting Bingo</h1></div>
      <div class="tabs">
        <button class="tab active" data-tab="setup">Setup</button>
        <button class="tab" data-tab="play">Play</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div id="setup" class="tabpane">
      <div class="panel">
        <div class="card">
          <h3>Event lists</h3>
          <div class="row">
            <span>Often</span>
            <span class="pill"><span class="dot often"></span>common</span>
          </div>
          <textarea id="often"></textarea>
          <div class="row" style="margin-top:10px">
            <span>Medium</span>
            <span class="pill"><span class="dot medium"></span>sometimes</span>
          </div>
          <textarea id="medium"></textarea>
          <div class="row" style="margin-top:10px">
            <span>Rare</span>
            <span class="pill"><span class="dot rare"></span>uncommon</span>
          </div>
          <textarea id="rare"></textarea>
          <div class="hint" style="margin-top:6px">One event per line. Examples are prefilled — edit them to match your team.</div>
        </div>

        <div class="card">
          <h3>Board & generation</h3>
          <div class="row">
            <span>Board size</span>
            <select id="size">
              <option value="5">5 × 5</option>
              <option value="4">4 × 4</option>
              <option value="3">3 × 3</option>
            </select>
          </div>
          <div class="row" style="margin-top:8px">
            <span>Free center</span>
            <select id="free">
              <option value="true">Yes (FREE)</option>
              <option value="false">No</option>
            </select>
          </div>
          <div class="row" style="margin-top:8px">
            <span>Counts mode</span>
            <select id="countMode">
              <option value="fixed">Fixed (manual counts)</option>
              <option value="auto">Auto (by ratio)</option>
            </select>
          </div>
          <div class="row" id="countsRow" style="margin-top:8px">
            <span>Counts (O/M/R)</span>
            <input id="counts" placeholder="e.g. 12,8,4" />
          </div>
          <div class="row" id="ratiosRow" style="margin-top:8px; display:none">
            <span>Ratios (O/M/R)</span>
            <input id="ratios" placeholder="e.g. 0.5,0.33,0.17" />
          </div>
          <div class="row" style="margin-top:8px">
            <span>Seed</span>
            <input id="seed" placeholder="optional – same seed ⇒ same board" />
          </div>
          <div class="controls">
            <button class="primary" id="generate">Generate board</button>
            <button class="ghost" id="random-seed">Randomize seed</button>
            <button class="ghost" id="share">Copy share link</button>
            <button class="ghost" id="export">Export config</button>
            <button class="ghost" id="import">Import config</button>
          </div>
          <div class="hint" style="margin-top:8px">Counts must add up to cell count (minus 1 if free center is ON). Example for 5×5 with FREE: 12 often, 8 medium, 4 rare ⇒ 24 total.</div>
        </div>
      </div>
    </div>

    <div id="play" class="tabpane" style="display:none">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="row" style="gap:8px"><span class="pill"><span class="dot often"></span>Often</span><span class="pill"><span class="dot medium"></span>Medium</span><span class="pill"><span class="dot rare"></span>Rare</span></div>
          <div class="controls" style="gap:8px">
            <button id="reset">Reset marks</button>
            <button id="re-roll">Re-roll (new board)</button>
          </div>
        </div>
        <div class="board">
          <div id="grid" class="grid"></div>
        </div>
        <div class="footer">Tap a square to mark it. Get a row, column, or diagonal for <span class="bingo-banner">BINGO!</span></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // ---- Utilities ----
    const qs = (sel, el=document) => el.querySelector(sel);
    const qsa = (sel, el=document) => [...el.querySelectorAll(sel)];

    const store = {
      get k(){ return 'meeting-bingo-v1' },
      save(cfg){ localStorage.setItem(this.k, JSON.stringify(cfg)); },
      load(){ try{ return JSON.parse(localStorage.getItem(this.k) || '{}'); }catch{ return {}; } }
    };

    function mulberry32(seed){
      let t = seed >>> 0;
      return function(){ t += 0x6D2B79F5; let r = Math.imul(t ^ t >>> 15, 1 | t); r ^= r + Math.imul(r ^ r >>> 7, 61 | r); return ((r ^ r >>> 14) >>> 0) / 4294967296; };
    }
    function xmur3(str){ let h=1779033703^str.length; for(let i=0;i<str.length;i++){ h=Math.imul(h^str.charCodeAt(i),3432918353); h=h<<13|h>>>19 } return ()=>{ h=Math.imul(h^h>>>16,2246822507); h=Math.imul(h^h>>>13,3266489909); return (h^h>>>16)>>>0 } }
    function seededShuffle(arr, rnd){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(rnd()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

    function copy(text){ navigator.clipboard.writeText(text).then(()=>toast('Copied link to clipboard')); }
    function toast(msg, t=2200){ const el=qs('#toast'); el.textContent = msg; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), t) }

    // ---- Defaults ----
    const defaults = {
      size: 5,
      free: true,
      countMode: 'fixed',
      counts: { often: 12, medium: 8, rare: 4 },
      ratios: { often: 0.5, medium: 0.33, rare: 0.17 },
      lists: {
        often: [
          'Someone says “you\'re on mute”',
          'Awkward 5s silence',
          '“Can you see my screen?”',
          'Dog or cat cameo',
          'Join/leave chime',
          'Action item assigned',
          'Someone shares the wrong screen',
          'Wi‑Fi hiccup / robot voice',
          '“Let\'s take this offline”',
          'Keyboard clacking is heard',
          'Tab explosion in browser',
          'Late joiner asks for recap',
          'Emoji reaction blast',
          'Someone eating on mic',
          'Background blur toggled'
        ],
        medium: [
          'Spreadsheet is live‑edited',
          'Calendar double‑book conflict',
          'Screen share permission issue',
          'Unexpected guest joins',
          'Reference to last quarter',
          'Poll launched',
          '“Circling back” appears',
          'Time zone confusion',
          'Microphone feedback squeal',
          'AI note‑taker joins the call'
        ],
        rare: [
          'Power outage / total drop',
          'Meeting ends early (≥10m)',
          'Live demo actually works first try',
          'Pet walks on keyboard',
          'Someone joins from a car',
          'Two people talk in unison >3×',
          'Camera falls over',
          'Whiteboard drawing appears'
        ]
      },
      seed: ''
    };

    // ---- State ----
    let cfg = { ...defaults, ...store.load() };

    // ---- UI wiring ----
    const els = {
      often: qs('#often'), medium: qs('#medium'), rare: qs('#rare'),
      size: qs('#size'), free: qs('#free'),
      countMode: qs('#countMode'), counts: qs('#counts'), ratios: qs('#ratios'),
      seed: qs('#seed'),
      grid: qs('#grid'),
      setupTab: qs('[data-tab="setup"]'), playTab: qs('[data-tab="play"]'),
      setupPane: qs('#setup'), playPane: qs('#play')
    };

    function applyCfgToInputs(){
      els.often.value = cfg.lists.often.join('
');
      els.medium.value = cfg.lists.medium.join('
');
      els.rare.value = cfg.lists.rare.join('
');
      els.size.value = String(cfg.size);
      els.free.value = String(cfg.free);
      els.countMode.value = cfg.countMode || 'fixed';
      els.counts.value = `${cfg.counts.often},${cfg.counts.medium},${cfg.counts.rare}`;
      els.ratios.value = `${cfg.ratios.often},${cfg.ratios.medium},${cfg.ratios.rare}`;
      els.seed.value = cfg.seed || '';
      toggleCountsUi();
    }

    function readCfgFromInputs(){
      const parseList = v => v.split('
').map(s=>s.trim()).filter(Boolean);
      const [o,m,r] = (els.counts.value || '').split(',').map(x=>parseInt(x.trim(),10)).map(x=>isFinite(x)?x:0);
      const [ro,rm,rr] = (els.ratios.value || '').split(',').map(x=>parseFloat(x.trim())).map(x=>isFinite(x)?x:0);
      cfg = {
        ...cfg,
        size: parseInt(els.size.value,10),
        free: els.free.value === 'true',
        countMode: els.countMode.value,
        counts: { often:o, medium:m, rare:r },
        ratios: { often:ro, medium:rm, rare:rr },
        lists: {
          often: parseList(els.often.value),
          medium: parseList(els.medium.value),
          rare: parseList(els.rare.value)
        },
        seed: els.seed.value.trim()
      };
      store.save(cfg);
    }

    // URL state (shareable)
    function encodeCfg(c){
      const skinny = { size:c.size, free:c.free, counts:c.counts, seed:c.seed, lists:c.lists };
      const json = JSON.stringify(skinny);
      return btoa(unescape(encodeURIComponent(json)));
    }
    function decodeCfg(s){
      try{ const json = decodeURIComponent(escape(atob(s))); return JSON.parse(json); }catch{ return null }
    }

    function params(){ const p=new URLSearchParams(location.search); return p }

    function useUrlConfigIfAny(){
      const p = params();
      if(p.has('c')){
        const conf = decodeCfg(p.get('c'));
        if(conf){ cfg = { ...cfg, ...conf }; store.save(cfg); }
      }
      if(p.has('seed')){ cfg.seed = p.get('seed'); }
    }

    function updateUrlForShare(){
      const p = new URLSearchParams();
      p.set('c', encodeCfg(cfg));
      if(cfg.seed) p.set('seed', cfg.seed);
      const url = `${location.origin}${location.pathname}?${p.toString()}`;
      return url;
    }

    // Bingo generation
    function hashSeed(s){ const h=xmur3(s||'default-seed'); return mulberry32(h()); }

    function pickFrom(list, n, rnd){
      if(n<=0) return [];
      const uniq = [...new Set(list)];
      if(uniq.length < n) throw new Error(`Not enough unique items (need ${n}, have ${uniq.length})`);
      return seededShuffle(uniq, rnd).slice(0,n);
    }

    function normalizeRatios(r){
      const sum = r.often + r.medium + r.rare;
      if(sum <= 0) return {often:1, medium:0, rare:0};
      return { often:r.often/sum, medium:r.medium/sum, rare:r.rare/sum };
    }

    function allocateCounts(total, ratios, avail){
      // Largest Remainder Method + capacity handling
      const r = normalizeRatios(ratios);
      const raw = { often: total*r.often, medium: total*r.medium, rare: total*r.rare };
      const base = { often: Math.floor(raw.often), medium: Math.floor(raw.medium), rare: Math.floor(raw.rare) };
      let assigned = base.often + base.medium + base.rare;
      const rema = [ ['often', raw.often - base.often], ['medium', raw.medium - base.medium], ['rare', raw.rare - base.rare] ]
        .sort((a,b)=>b[1]-a[1]);
      while(assigned < total){
        for(const [k] of rema){ if(assigned>=total) break; base[k]++; assigned++; }
      }
      // Respect availability; reflow shortfalls
      const result = {...base};
      const keys = ['often','medium','rare'];
      let overflow = 0;
      for(const k of keys){ if(result[k] > avail[k]){ overflow += (result[k]-avail[k]); result[k]=avail[k]; } }
      while(overflow > 0){
        // give remaining capacity to any category with room
        let moved=false;
        for(const k of keys){ const room = Math.max(0, avail[k]-result[k]); if(room>0){ const add=Math.min(room, overflow); result[k]+=add; overflow-=add; moved=true; if(overflow===0) break; } }
        if(!moved) break; // nowhere to put
      }
      const sumRes = result.often + result.medium + result.rare;
      return {counts:result, sum:sumRes};
    }

    function generateBoard(){
      readCfgFromInputs();
      const N = cfg.size;
      const cellsCount = N*N - (cfg.free ? 1 : 0);

      let counts = { ...cfg.counts };
      if(cfg.countMode === 'auto'){
        const avail = { often: new Set(cfg.lists.often).size, medium: new Set(cfg.lists.medium).size, rare: new Set(cfg.lists.rare).size };
        const {counts:autoCounts, sum} = allocateCounts(cellsCount, cfg.ratios, avail);
        if(sum !== cellsCount){ toast(`Not enough unique items to fill ${cellsCount} cells. Add more events or adjust ratios.`); return; }
        counts = autoCounts;
      }

      const needTotal = counts.often + counts.medium + counts.rare; return; }

      const rnd = cfg.seed ? hashSeed(cfg.seed) : hashSeed(String(Date.now()));
      const chosen = [];
      try{
        chosen.push(...pickFrom(cfg.lists.often, counts.often, rnd).map(x=>({t:x,cat:'often'})));
        chosen.push(...pickFrom(cfg.lists.medium, counts.medium, rnd).map(x=>({t:x,cat:'medium'})));
        chosen.push(...pickFrom(cfg.lists.rare, counts.rare, rnd).map(x=>({t:x,cat:'rare'})));.map(x=>({t:x,cat:'often'})));
        chosen.push(...pickFrom(cfg.lists.medium, cfg.counts.medium, rnd).map(x=>({t:x,cat:'medium'})));
        chosen.push(...pickFrom(cfg.lists.rare, cfg.counts.rare, rnd).map(x=>({t:x,cat:'rare'})));
      }catch(e){ toast(e.message); return; }

      const rnd2 = hashSeed((cfg.seed||'')+'-layout');
      const tiles = seededShuffle(chosen, rnd2);

      const grid = [];
      let k=0;
      for(let r=0;r<N;r++){
        const row=[];
        for(let c=0;c<N;c++){
          if(cfg.free && r===Math.floor(N/2) && c===Math.floor(N/2)){
            row.push({t:'FREE',cat:'free',marked:true});
          }else{
            row.push(tiles[k++]);
          }
        }
        grid.push(row);
      }
      renderBoard(grid);
      els.playTab.click();
      // Persist last generated layout for reload
      localStorage.setItem('meeting-bingo-last-grid', JSON.stringify({grid, N}));
    }

    function renderBoard(grid){
      const N = grid.length;
      els.grid.style.gridTemplateColumns = `repeat(${N},1fr)`;
      els.grid.innerHTML = '';
      grid.forEach((row, r)=>{
        row.forEach((cell, c)=>{
          const d=document.createElement('div');
          d.className = 'cell'+(cell.cat==='free'?' free':'');
          if(cell.marked) d.classList.add('marked');
          d.dataset.r=r; d.dataset.c=c; d.dataset.cat=cell.cat;
          d.innerHTML = `<small>${cell.cat}</small><div class="label">${escapeHtml(cell.t)}</div>`;
          d.addEventListener('click', ()=>{
            d.classList.toggle('marked');
            checkBingo();
            saveMarks();
          });
          els.grid.appendChild(d);
        })
      })
      checkBingo();
    }

    function escapeHtml(str){ return str.replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }

    function saveMarks(){
      const marks = qsa('.cell').map((el,i)=>el.classList.contains('marked')?1:0);
      localStorage.setItem('meeting-bingo-marks', JSON.stringify(marks));
    }

    function restoreMarks(){
      const s = localStorage.getItem('meeting-bingo-marks');
      if(!s) return;
      try{ const marks = JSON.parse(s); qsa('.cell').forEach((el,i)=>{ if(marks[i]) el.classList.add('marked'); else el.classList.remove('marked'); }); }catch{}
    }

    function resetMarks(){ qsa('.cell').forEach(el=>el.classList.remove('marked')); saveMarks(); }

    function checkBingo(){
      const cells = qsa('.cell');
      if(cells.length===0) return;
      const N = Math.sqrt(cells.length);
      const M = [...Array(N)].map(()=>Array(N).fill(false));
      cells.forEach((el,i)=>{ const r=Math.floor(i/N), c=i%N; M[r][c]=el.classList.contains('marked') });

      const lines=[];
      for(let i=0;i<N;i++){
        if(M[i].every(Boolean)) lines.push('row');
        if(M.map(r=>r[i]).every(Boolean)) lines.push('col');
      }
      if(M.map((r,i)=>r[i]).every(Boolean)) lines.push('diag');
      if(M.map((r,i)=>r[N-1-i]).every(Boolean)) lines.push('diag');
      if(lines.length>0){ toast(`BINGO! (${lines.length} line${lines.length>1?'s':''}) 🎉`, 1800); confetti(); }
    }

    function confetti(){
      // Tiny confetti without external libs
      const n=80; const container=document.body; const frags=[]; const w=window.innerWidth, h=window.innerHeight;
      for(let i=0;i<n;i++){
        const s=document.createElement('div');
        s.style.position='fixed'; s.style.left=(Math.random()*w)+'px'; s.style.top='-10px'; s.style.width='6px'; s.style.height='10px';
        s.style.background=`hsl(${Math.random()*360},90%,60%)`; s.style.opacity='0.9'; s.style.borderRadius='2px'; s.style.transform=`rotate(${Math.random()*360}deg)`;
        s.style.zIndex=30; container.appendChild(s); frags.push(s);
        const dur=800+Math.random()*1200; const dx=(-40+Math.random()*80);
        s.animate([{transform:s.style.transform, top:'-10px'},{transform:`translate(${dx}px, ${h+20}px) rotate(${Math.random()*360}deg)`, top:(h+20)+'px'}],{duration:dur, easing:'cubic-bezier(.2,.7,.2,1)'}).onfinish=()=>s.remove();
      }
    }

    // ---- Event hooks ----
    qsa('.tab').forEach(btn=>btn.addEventListener('click',()=>{
      qsa('.tab').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      qsa('.tabpane').forEach(p=>p.style.display='none');
      qs('#'+tab).style.display='block';
    }))

    qs('#generate').addEventListener('click', generateBoard);
    qs('#random-seed').addEventListener('click', ()=>{ els.seed.value = Math.random().toString(36).slice(2,10); toast('New random seed set'); });
    qs('#share').addEventListener('click', ()=>{ readCfgFromInputs(); copy(updateUrlForShare()); });
    qs('#export').addEventListener('click', ()=>{ readCfgFromInputs(); copy(encodeCfg(cfg)); });
    qs('#import').addEventListener('click', ()=>{ const s=prompt('Paste config code'); if(!s) return; const c=decodeCfg(s); if(!c){ toast('Invalid config'); return } cfg={...cfg,...c}; applyCfgToInputs(); toast('Config imported'); });
    qs('#reset').addEventListener('click', resetMarks);
    qs('#re-roll').addEventListener('click', ()=>{ els.seed.value = Math.random().toString(36).slice(2,10); generateBoard(); });

    function toggleCountsUi(){
      const mode = els.countMode.value;
      qs('#countsRow').style.display = mode==='fixed' ? '' : 'none';
      qs('#ratiosRow').style.display = mode==='auto' ? '' : 'none';
    }
    els.countMode.addEventListener('change', ()=>{ toggleCountsUi(); readCfgFromInputs(); });

    // Restore last board if present
    function tryRestoreLast(){
      const last = localStorage.getItem('meeting-bingo-last-grid');
      if(!last) return false;
      try{ const {grid} = JSON.parse(last); renderBoard(grid); return true; }catch{ return false }
    }

    // Initialization
    useUrlConfigIfAny();
    applyCfgToInputs();

    // If a share link brought us here, jump straight to play and generate from seed
    if(params().has('c')){ generateBoard(); }
    else if(!tryRestoreLast()){
      // render a sample board from defaults
      generateBoard();
    }
    restoreMarks();
  </script>
</body>
</html>
